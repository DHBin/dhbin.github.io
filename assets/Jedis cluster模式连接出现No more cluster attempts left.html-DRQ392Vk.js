import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,b as i,o as a}from"./app-CqnfWZLp.js";const n={};function l(p,t){return a(),s("div",null,t[0]||(t[0]=[i(`<h1 id="jedis-cluster模式连接出现no-more-cluster-attempts-left" tabindex="-1"><a class="header-anchor" href="#jedis-cluster模式连接出现no-more-cluster-attempts-left"><span>Jedis cluster模式连接出现No more cluster attempts left</span></a></h1><p>同事在测试环境jedis cluster模式出现<code>redis.clients.jedis.exceptions.JedisClusterMaxAttemptsException: No more cluster attempts left.</code>报错，找到我帮忙定位下问题</p><p><img src="https://cdn.dhbin.cn/202304102012717.png" alt=""></p><p>通过堆栈信息找到对应的源码位置<code>redis.clients.jedis.JedisClusterCommand#runWithRetries</code></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> runWithRetries</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">final</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> slot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> attempts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> tryRandomNode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> JedisRedirectionException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> redirect) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (attempts </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> JedisClusterMaxAttemptsException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;No more cluster attempts left.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从源码中分析得到，在测试<code>attempts</code>次之后就会抛出<code>No more cluster attempts left</code>的异常，根据源码下文有两种异常会导致重试</p><ul><li>JedisConnectionException：连接redis出现异常</li><li>JedisRedirectionException：redis重定向会抛出的异常，比如MOVE</li></ul><p><img src="https://cdn.dhbin.cn/202304102012522.png" alt=""></p><p>在对应的位置打上断点，运行出现问题的接口，出现以下报错</p><p><img src="https://cdn.dhbin.cn/202304102012155.png" alt=""></p><p>问题就很明显了，<code>ERR Client sent AUTH, but no password is set</code>，意思是项目配置设置了密码，但是这个redis节点没有设置密码，是运维的同学漏配置了</p>`,11)]))}const c=e(n,[["render",l]]),h=JSON.parse('{"path":"/tech/java/Jedis%20cluster%E6%A8%A1%E5%BC%8F%E8%BF%9E%E6%8E%A5%E5%87%BA%E7%8E%B0No%20more%20cluster%20attempts%20left.html","title":"Jedis cluster模式连接出现No more cluster attempts left","lang":"zh-CN","frontmatter":{"date":"2023-04-10T00:00:00.000Z","category":["Java"],"tag":["Java","Jedis","Redis"],"description":"Jedis cluster模式连接出现No more cluster attempts left 同事在测试环境jedis cluster模式出现redis.clients.jedis.exceptions.JedisClusterMaxAttemptsException: No more cluster attempts left.报错，找到我帮忙定...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Jedis cluster模式连接出现No more cluster attempts left\\",\\"image\\":[\\"https://cdn.dhbin.cn/202304102012717.png\\",\\"https://cdn.dhbin.cn/202304102012522.png\\",\\"https://cdn.dhbin.cn/202304102012155.png\\"],\\"datePublished\\":\\"2023-04-10T00:00:00.000Z\\",\\"dateModified\\":\\"2023-04-10T12:15:46.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"DHB\\",\\"url\\":\\"https://dhbin.cn\\"}]}"],["meta",{"property":"og:url","content":"https://dhbin.cn/tech/java/Jedis%20cluster%E6%A8%A1%E5%BC%8F%E8%BF%9E%E6%8E%A5%E5%87%BA%E7%8E%B0No%20more%20cluster%20attempts%20left.html"}],["meta",{"property":"og:site_name","content":"HB技术栈"}],["meta",{"property":"og:title","content":"Jedis cluster模式连接出现No more cluster attempts left"}],["meta",{"property":"og:description","content":"Jedis cluster模式连接出现No more cluster attempts left 同事在测试环境jedis cluster模式出现redis.clients.jedis.exceptions.JedisClusterMaxAttemptsException: No more cluster attempts left.报错，找到我帮忙定..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.dhbin.cn/202304102012717.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-04-10T12:15:46.000Z"}],["meta",{"property":"article:tag","content":"Redis"}],["meta",{"property":"article:tag","content":"Jedis"}],["meta",{"property":"article:tag","content":"Java"}],["meta",{"property":"article:published_time","content":"2023-04-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-04-10T12:15:46.000Z"}]]},"git":{"createdTime":1681128946000,"updatedTime":1681128946000,"contributors":[{"name":"dhb","username":"dhb","email":"xx158@qq.com","commits":1,"url":"https://github.com/dhb"}]},"readingTime":{"minutes":0.81,"words":243},"excerpt":"\\n<p>同事在测试环境jedis cluster模式出现<code>redis.clients.jedis.exceptions.JedisClusterMaxAttemptsException: No more cluster attempts left.</code>报错，找到我帮忙定位下问题</p>\\n<p><img src=\\"https://cdn.dhbin.cn/202304102012717.png\\" alt=\\"\\"></p>\\n<p>通过堆栈信息找到对应的源码位置<code>redis.clients.jedis.JedisClusterCommand#runWithRetries</code></p>","autoDesc":true}');export{c as comp,h as data};
